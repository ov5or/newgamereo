<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            transition: all 0.3s ease;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 20%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
        }

        body.accessibility-mode {
            font-size: 1.2em;
            line-height: 1.6;
        }

        body.accessibility-mode.high-contrast {
            background: #000;
            color: #fff;
        }

        body.rtl {
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #fd79a8);
            background-size: 400% 400%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 3s ease-in-out infinite;
            margin-bottom: 1rem;
            text-shadow: 0 0 30px rgba(255,255,255,0.5);
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 2rem;
            margin: 1rem 0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1), 
                        0 5px 15px rgba(0,0,0,0.07),
                        inset 0 1px 0 rgba(255,255,255,0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .card:hover::before {
            left: 100%;
        }

        .dark-mode .card {
            background: rgba(52, 73, 94, 0.95);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2, #ff6b6b);
            background-size: 200% 200%;
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: inline-block;
            text-decoration: none;
            text-align: center;
            margin: 10px;
            min-width: 150px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            animation: buttonGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes buttonGlow {
            0% { box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); }
            100% { box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5); }
        }

        .btn:hover {
            transform: translateY(-5px) scale(1.05);
            background-position: 100% 0;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }

        .btn.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        .btn.practice-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71, #3498db);
            background-size: 200% 200%;
            animation: practiceGlow 3s ease-in-out infinite;
        }
        
        @keyframes practiceGlow {
            0%, 100% { 
                background-position: 0% 50%;
                box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
            }
            50% { 
                background-position: 100% 50%;
                box-shadow: 0 12px 35px rgba(52, 152, 219, 0.5);
            }
        }

        .input-group {
            margin: 1rem 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .dark-mode .input-group input, .dark-mode .input-group select {
            background: #34495e;
            border-color: #5a6c7d;
            color: #ecf0f1;
        }

        .tabs {
            display: flex;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 2rem;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab.active {
            background: rgba(255,255,255,0.9);
            color: #333;
        }

        .dark-mode .tab.active {
            background: rgba(52, 73, 94, 0.9);
            color: #ecf0f1;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .player-list {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .player {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }

        .rtl .avatar {
            margin-right: 0;
            margin-left: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255,255,255,0.3);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .question-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 2rem;
            margin: 1rem 0;
            text-align: center;
        }

        .dark-mode .question-card {
            background: rgba(52, 73, 94, 0.95);
        }

        .question-text {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .timer-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: conic-gradient(#e74c3c 0deg, #3498db 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem auto;
            font-size: 2rem;
            font-weight: bold;
            color: white;
        }

        .answer-input {
            width: 100%;
            max-width: 400px;
            padding: 15px;
            font-size: 1.2rem;
            border: 3px solid #3498db;
            border-radius: 15px;
            text-align: center;
            margin: 1rem auto;
            display: block;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 1rem 0;
        }

        .option-btn {
            padding: 15px;
            border: 2px solid #3498db;
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-btn:hover {
            background: #3498db;
            color: white;
        }

        .option-btn.correct {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }

        .option-btn.wrong {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }

        .xp-bar {
            background: rgba(255,255,255,0.3);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(45deg, #f39c12, #e67e22);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 1rem 0;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }

        .device-icon {
            width: 20px;
            height: 20px;
            margin-left: 10px;
        }

        .rtl .device-icon {
            margin-left: 0;
            margin-right: 10px;
        }

        .leaderboard {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1rem;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }

        .leaderboard-item.winner {
            background: linear-gradient(45deg, #f1c40f, #f39c12);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #3498db;
        }

        .toggle-slider {
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        .countdown {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            color: #e74c3c;
            margin: 2rem 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .btn {
                width: 100%;
                margin: 5px 0;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }

        .fade-out {
            animation: fadeOut 0.5s ease forwards;
        }

        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(-20px); }
        }

        .level-up {
            animation: levelUp 1s ease;
        }

        @keyframes levelUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #e74c3c;
        }

        .notification.warning {
            background: #f39c12;
        }

        .party-code {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 15px;
            margin: 1rem 0;
            letter-spacing: 3px;
        }

        .invite-link {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            word-break: break-all;
            margin: 1rem 0;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .difficulty-easy {
            background: #27ae60;
            color: white;
        }

        .difficulty-hard {
            background: #f39c12;
            color: white;
        }

        .difficulty-impossible {
            background: #e74c3c;
            color: white;
        }

        .shop-item {
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .coin-icon {
            color: #f1c40f;
            font-weight: bold;
        }

        .rank-badge {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .glow-effect {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(102, 126, 234, 0.5); }
            to { box-shadow: 0 0 30px rgba(255, 107, 107, 0.7); }
        }
        
        .shake-animation {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3) translateY(-50px); opacity: 0; }
            50% { transform: scale(1.1); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        .slide-up {
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .neon-text {
            text-shadow: 0 0 5px currentColor,
                         0 0 10px currentColor,
                         0 0 15px currentColor,
                         0 0 20px currentColor;
        }
        
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(3, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="floating-particles" id="particles"></div>
    
    <div class="container">
        <div class="header">
            <h1 id="app-title" class="neon-text">Quiz Master</h1>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('main')" id="tab-main">Main</div>
            <div class="tab" onclick="showTab('profile')" id="tab-profile">Profile</div>
            <div class="tab" onclick="showTab('shop')" id="tab-shop">Shop</div>
            <div class="tab" onclick="showTab('settings')" id="tab-settings">Settings</div>
        </div>

        <div id="main-screen" class="screen active">
            <div class="card">
                <h2 id="main-title">Welcome to Quiz Master</h2>
                <div style="text-align: center; margin: 2rem 0;">
                    <button class="btn practice-btn pulse-animation" onclick="startPracticeMode()" id="practice-btn">üéØ Practice Mode - Play Solo!</button>
                    <button class="btn glow-effect" onclick="showCreateParty()" id="create-party-btn">üéâ Create Party</button>
                    <button class="btn secondary" onclick="showJoinParty()" id="join-party-btn">üöÄ Join Party</button>
                </div>
                <div style="text-align: center; margin: 1rem 0; background: rgba(39, 174, 96, 0.1); padding: 15px; border-radius: 15px;">
                    <p style="font-size: 1.1rem; font-weight: 600;">‚ú® New! Practice Mode is now available for offline play!</p>
                    <p style="opacity: 0.8;">Perfect your skills, earn XP and coins without needing other players</p>
                </div>
            </div>
        </div>

        <div id="create-party-screen" class="screen">
            <div class="card">
                <h2 id="create-title">Create New Party</h2>
                <div class="input-group">
                    <label id="players-label">Number of Players:</label>
                    <select id="max-players">
                        <option value="2">2 Players</option>
                        <option value="4">4 Players</option>
                        <option value="6">6 Players</option>
                        <option value="8">8 Players</option>
                    </select>
                </div>
                <div class="input-group">
                    <label id="language-label">Language:</label>
                    <select id="game-language" onchange="changeLanguage()">
                        <option value="en">English</option>
                        <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                    </select>
                </div>
                <div class="input-group">
                    <label id="category-label">Quiz Category:</label>
                    <select id="quiz-category">
                        <option value="sports">Sports</option>
                        <option value="geography">Geography</option>
                        <option value="history">History</option>
                        <option value="science">Science</option>
                        <option value="general">General Knowledge</option>
                    </select>
                </div>
                <div class="input-group">
                    <label id="difficulty-label">Difficulty:</label>
                    <select id="quiz-difficulty">
                        <option value="random">Random</option>
                        <option value="easy">Easy</option>
                        <option value="hard">Hard</option>
                        <option value="impossible">Impossible</option>
                    </select>
                </div>
                <div style="text-align: center; margin: 2rem 0;">
                    <button class="btn" onclick="createParty()" id="create-btn">Create Party</button>
                    <button class="btn secondary" onclick="showMain()" id="back-btn">Back</button>
                </div>
            </div>
        </div>

        <div id="join-party-screen" class="screen">
            <div class="card">
                <h2 id="join-title">Join Party</h2>
                <div class="input-group">
                    <label id="code-label">Party Code:</label>
                    <input type="text" id="party-code-input" placeholder="Enter party code" maxlength="6">
                </div>
                <div style="text-align: center; margin: 2rem 0;">
                    <button class="btn" onclick="joinParty()" id="join-btn">Join Party</button>
                    <button class="btn secondary" onclick="showMain()" id="back-join-btn">Back</button>
                </div>
            </div>
        </div>

        <div id="party-lobby-screen" class="screen">
            <div class="card">
                <h2 id="lobby-title">Party Lobby</h2>
                <div class="party-code" id="current-party-code">ABC123</div>
                <div class="invite-link" id="invite-link-display"></div>
                <div class="player-list" id="player-list"></div>
                <div class="countdown" id="lobby-countdown"></div>
                <div style="text-align: center; margin: 2rem 0;" id="host-controls">
                    <button class="btn" onclick="startGame()" id="start-game-btn">Start Game</button>
                    <button class="btn danger" onclick="leaveParty()" id="leave-party-btn">Leave Party</button>
                </div>
            </div>
        </div>

        <div id="game-screen" class="screen">
            <div class="card">
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="current-question">1</div>
                        <div id="question-counter">Question</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="current-score">0</div>
                        <div id="score-label">Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="current-streak">0</div>
                        <div id="streak-label">Streak</div>
                    </div>
                </div>
                <div class="question-card">
                    <div class="question-text" id="question-text"></div>
                    <div class="timer-circle" id="timer-display">10</div>
                    <input type="text" class="answer-input" id="answer-input" placeholder="Enter your answer..." disabled>
                    <div class="options-grid hidden" id="options-container"></div>
                </div>
            </div>
        </div>

        <div id="game-results-screen" class="screen">
            <div class="card">
                <h2 id="results-title">Game Results</h2>
                <div class="leaderboard" id="final-leaderboard"></div>
                <div class="countdown" id="results-countdown"></div>
                <div style="text-align: center; margin: 2rem 0;">
                    <button class="btn" onclick="returnToLobby()" id="return-lobby-btn">Return to Lobby</button>
                    <button class="btn secondary" onclick="showMain()" id="main-menu-btn">Main Menu</button>
                </div>
            </div>
        </div>

        <div id="profile-screen" class="screen">
            <div class="card">
                <h2 id="profile-title">Player Profile</h2>
                <div style="text-align: center; margin: 2rem 0;">
                    <div class="avatar" id="profile-avatar" style="width: 80px; height: 80px; font-size: 2rem; margin: 0 auto 1rem;">
                        <span id="avatar-letter">A</span>
                    </div>
                    <div class="input-group">
                        <label id="username-label">Username:</label>
                        <input type="text" id="username-input" maxlength="12">
                        <button class="btn secondary" onclick="updateUsername()" id="update-username-btn">Update</button>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="player-level">1</div>
                        <div id="level-label">Level</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="player-xp">0</div>
                        <div id="xp-label">XP</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="player-coins">0</div>
                        <div id="coins-label">Coins</div>
                    </div>
                </div>
                <div class="xp-bar">
                    <div class="xp-fill" id="xp-progress" style="width: 0%"></div>
                </div>
                <div class="rank-badge" id="player-rank">Rookie</div>
                <div style="margin: 1rem 0;">
                    <span id="device-info">Device: </span>
                    <span id="device-name"></span>
                </div>
            </div>
        </div>

        <div id="shop-screen" class="screen">
            <div class="card">
                <h2 id="shop-title">Cosmetic Shop</h2>
                <div id="shop-items">
                    <div class="shop-item">
                        <div>
                            <h3>Pro Title</h3>
                            <p>Unlock the "Pro" title</p>
                        </div>
                        <div>
                            <span class="coin-icon">ü™ô 50</span>
                            <button class="btn" onclick="buyItem('pro-title', 50)">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div>
                            <h3>Master Badge</h3>
                            <p>Show your mastery with this badge</p>
                        </div>
                        <div>
                            <span class="coin-icon">ü™ô 100</span>
                            <button class="btn" onclick="buyItem('master-badge', 100)">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div>
                            <h3>Legend Aura</h3>
                            <p>Legendary visual effect</p>
                        </div>
                        <div>
                            <span class="coin-icon">ü™ô 200</span>
                            <button class="btn" onclick="buyItem('legend-aura', 200)">Buy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="settings-screen" class="screen">
            <div class="card">
                <h2 id="settings-title">Settings</h2>
                <div class="settings-grid">
                    <div class="stat-item">
                        <h3 id="dark-mode-label">Dark Mode</h3>
                        <div class="toggle-switch" id="dark-mode-toggle" onclick="toggleDarkMode()">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <h3 id="accessibility-label">Accessibility Mode</h3>
                        <div class="toggle-switch" id="accessibility-toggle" onclick="toggleAccessibility()">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <h3 id="high-contrast-label">High Contrast</h3>
                        <div class="toggle-switch" id="contrast-toggle" onclick="toggleHighContrast()">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <h3 id="sound-label">Sound Effects</h3>
                        <div class="toggle-switch active" id="sound-toggle" onclick="toggleSound()">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="practice-screen" class="screen">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2>üéØ Practice Mode</h2>
                    <button class="btn danger" onclick="exitPractice()">Exit</button>
                </div>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="practice-question-num">1</div>
                        <div>Question</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="practice-score">0</div>
                        <div>Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="practice-streak">0</div>
                        <div>Streak</div>
                    </div>
                </div>
                
                <div class="question-card">
                    <div class="question-text" id="practice-question-text">Loading question...</div>
                    <div class="timer-circle" id="practice-timer-display">10</div>
                    <input type="text" class="answer-input" id="practice-answer-input" placeholder="Type your answer...">
                    <div class="options-grid hidden" id="practice-options-container"></div>
                </div>
            </div>
        </div>

        <div id="practice-results-screen" class="screen">
            <div class="card">
                <h2>üèÜ Practice Complete!</h2>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="practice-final-score">0</div>
                        <div>Final Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="practice-total-questions">10</div>
                        <div>Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="practice-correct-answers">0</div>
                        <div>Correct</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 2rem 0;">
                    <button class="btn practice-btn" onclick="restartPractice()">üîÑ Practice Again</button>
                    <button class="btn secondary" onclick="exitPractice()">üè† Main Menu</button>
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin: 1rem 0;">
                    <h3>üéâ Practice Benefits:</h3>
                    <ul style="text-align: left; margin: 10px 0;">
                        <li>‚úì Earn XP and coins</li>
                        <li>‚úì No pressure from other players</li>
                        <li>‚úì Learn at your own pace</li>
                        <li>‚úì Improve your skills</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        let currentUser = {
            username: '',
            level: 1,
            xp: 0,
            coins: 0,
            streak: 0,
            totalGames: 0,
            wins: 0,
            avatar: null,
            rank: 'Rookie',
            titles: [],
            ownedItems: [],
            usernameChanges: 0,
            lastUsernameChange: 0,
            isBanned: false
        };

        let gameState = {
            currentParty: null,
            isHost: false,
            currentQuestion: 0,
            score: 0,
            streak: 0,
            answers: [],
            timeLeft: 10,
            gameStarted: false,
            language: 'en',
            difficulty: 'random'
        };

        let parties = new Map();
        let questions = {
            sports: {
                easy: [
                    { question: "How many players are on a basketball team?", answer: "5", options: ["3", "4", "5", "6", "7"] },
                    { question: "What sport uses a puck?", answer: "hockey", options: ["hockey", "soccer", "tennis", "golf", "baseball"] },
                    { question: "How many holes are on a golf course?", answer: "18", options: ["16", "17", "18", "19", "20"] }
                ],
                hard: [
                    { question: "Which country won the first FIFA World Cup?", answer: "uruguay", options: ["brazil", "argentina", "uruguay", "germany", "italy"] },
                    { question: "What is the maximum score in ten-pin bowling?", answer: "300", options: ["250", "280", "300", "320", "350"] }
                ],
                impossible: [
                    { question: "Who holds the record for most goals in a single NHL season?", answer: "gretzky", options: ["gretzky", "lemieux", "ovechkin", "hull", "esposito"] }
                ]
            },
            geography: {
                easy: [
                    { question: "What is the capital of France?", answer: "paris", options: ["london", "madrid", "paris", "rome", "berlin"] },
                    { question: "Which continent is Egypt in?", answer: "africa", options: ["asia", "africa", "europe", "america", "australia"] },
                    { question: "What is the largest ocean?", answer: "pacific", options: ["atlantic", "indian", "pacific", "arctic", "southern"] }
                ],
                hard: [
                    { question: "What is the smallest country in the world?", answer: "vatican", options: ["monaco", "vatican", "liechtenstein", "san marino", "andorra"] },
                    { question: "Which river flows through Cairo?", answer: "nile", options: ["amazon", "mississippi", "nile", "ganges", "yangtze"] }
                ],
                impossible: [
                    { question: "What is the deepest point in Earth's oceans?", answer: "mariana trench", options: ["mariana trench", "puerto rico trench", "java trench", "philippine trench", "kermadec trench"] }
                ]
            }
        };

        let translations = {
            en: {
                'app-title': 'Quiz Master',
                'main-title': 'Welcome to Quiz Master',
                'create-party-btn': 'Create Party',
                'join-party-btn': 'Join Party',
                'create-title': 'Create New Party',
                'players-label': 'Number of Players:',
                'language-label': 'Language:',
                'category-label': 'Quiz Category:',
                'difficulty-label': 'Difficulty:',
                'create-btn': 'Create Party',
                'back-btn': 'Back',
                'join-title': 'Join Party',
                'code-label': 'Party Code:',
                'join-btn': 'Join Party',
                'back-join-btn': 'Back',
                'lobby-title': 'Party Lobby',
                'start-game-btn': 'Start Game',
                'leave-party-btn': 'Leave Party',
                'question-counter': 'Question',
                'score-label': 'Score',
                'streak-label': 'Streak',
                'results-title': 'Game Results',
                'return-lobby-btn': 'Return to Lobby',
                'main-menu-btn': 'Main Menu',
                'profile-title': 'Player Profile',
                'username-label': 'Username:',
                'update-username-btn': 'Update',
                'level-label': 'Level',
                'xp-label': 'XP',
                'coins-label': 'Coins',
                'shop-title': 'Cosmetic Shop',
                'settings-title': 'Settings',
                'dark-mode-label': 'Dark Mode',
                'accessibility-label': 'Accessibility Mode',
                'high-contrast-label': 'High Contrast',
                'sound-label': 'Sound Effects',
                'device-info': 'Device: ',
                'tab-main': 'Main',
                'tab-profile': 'Profile',
                'tab-shop': 'Shop',
                'tab-settings': 'Settings'
            },
            ar: {
                'app-title': 'ÿ≥ŸäÿØ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©',
                'main-title': 'ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿ≥ŸäÿØ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©',
                'create-party-btn': 'ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÅŸÑÿ©',
                'join-party-btn': 'ÿßŸÜÿ∂ŸÖÿßŸÖ ŸÑÿ≠ŸÅŸÑÿ©',
                'create-title': 'ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÅŸÑÿ© ÿ¨ÿØŸäÿØÿ©',
                'players-label': 'ÿπÿØÿØ ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ:',
                'language-label': 'ÿßŸÑŸÑÿ∫ÿ©:',
                'category-label': 'ŸÅÿ¶ÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©:',
                'difficulty-label': 'ÿßŸÑÿµÿπŸàÿ®ÿ©:',
                'create-btn': 'ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÅŸÑÿ©',
                'back-btn': 'ÿπŸàÿØÿ©',
                'join-title': 'ÿßŸÜÿ∂ŸÖÿßŸÖ ŸÑÿ≠ŸÅŸÑÿ©',
                'code-label': 'ÿ±ŸÖÿ≤ ÿßŸÑÿ≠ŸÅŸÑÿ©:',
                'join-btn': 'ÿßŸÜÿ∂ŸÖÿßŸÖ',
                'back-join-btn': 'ÿπŸàÿØÿ©',
                'lobby-title': 'ÿµÿßŸÑÿ© ÿßŸÑÿ≠ŸÅŸÑÿ©',
                'start-game-btn': 'ÿ®ÿØÿ° ÿßŸÑŸÑÿπÿ®ÿ©',
                'leave-party-btn': 'ÿ™ÿ±ŸÉ ÿßŸÑÿ≠ŸÅŸÑÿ©',
                'question-counter': 'ÿßŸÑÿ≥ÿ§ÿßŸÑ',
                'score-label': 'ÿßŸÑŸÜŸÇÿßÿ∑',
                'streak-label': 'ÿßŸÑÿ≥ŸÑÿ≥ŸÑÿ©',
                'results-title': 'ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÑÿπÿ®ÿ©',
                'return-lobby-btn': 'ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµÿßŸÑÿ©',
                'main-menu-btn': 'ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©',
                'profile-title': 'ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä',
                'username-label': 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ:',
                'update-username-btn': 'ÿ™ÿ≠ÿØŸäÿ´',
                'level-label': 'ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ',
                'xp-label': 'ÿßŸÑÿÆÿ®ÿ±ÿ©',
                'coins-label': 'ÿßŸÑÿπŸÖŸÑÿßÿ™',
                'shop-title': 'ŸÖÿ™ÿ¨ÿ± ÿßŸÑÿ™ÿ¨ŸÖŸäŸÑ',
                'settings-title': 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
                'dark-mode-label': 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÖÿ∏ŸÑŸÖ',
                'accessibility-label': 'Ÿàÿ∂ÿπ ÿ•ŸÖŸÉÿßŸÜŸäÿ© ÿßŸÑŸàÿµŸàŸÑ',
                'high-contrast-label': 'ÿßŸÑÿ™ÿ®ÿßŸäŸÜ ÿßŸÑÿπÿßŸÑŸä',
                'sound-label': 'ÿßŸÑŸÖÿ§ÿ´ÿ±ÿßÿ™ ÿßŸÑÿµŸàÿ™Ÿäÿ©',
                'device-info': 'ÿßŸÑÿ¨Ÿáÿßÿ≤: ',
                'tab-main': 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©',
                'tab-profile': 'ÿßŸÑŸÖŸÑŸÅ',
                'tab-shop': 'ÿßŸÑŸÖÿ™ÿ¨ÿ±',
                'tab-settings': 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™'
            }
        };

        let badWords = ['fuck', 'shit', 'damn', 'hell', 'ass', 'bitch', 'crap'];
        let sounds = {
            correct: null,
            wrong: null,
            levelUp: null,
            click: null,
            notification: null
        };
        let soundEnabled = true;

        function initializeApp() {
            loadUserData();
            updateUI();
            detectDevice();
            loadSettings();
            checkUrlParams();
            initializeSounds();
            applyLanguage();
        }

        function initializeSounds() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            sounds.correct = createBeep(audioContext, 523.25, 0.2);
            sounds.wrong = createBeep(audioContext, 196, 0.5);
            sounds.levelUp = createBeep(audioContext, 659.25, 0.3);
            sounds.click = createBeep(audioContext, 440, 0.1);
            sounds.notification = createBeep(audioContext, 349.23, 0.2);
        }

        function createBeep(audioContext, frequency, duration) {
            return function() {
                if (!soundEnabled) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            };
        }

        function playSound(soundType) {
            if (sounds[soundType] && soundEnabled) {
                sounds[soundType]();
            }
        }

        function loadUserData() {
            const savedUser = localStorage.getItem('quizMasterUser');
            if (savedUser) {
                currentUser = { ...currentUser, ...JSON.parse(savedUser) };
            } else {
                currentUser.username = generateGuestUsername();
            }
            
            if (!currentUser.username) {
                currentUser.username = generateGuestUsername();
            }
        }

        function saveUserData() {
            localStorage.setItem('quizMasterUser', JSON.stringify(currentUser));
        }

        function generateGuestUsername() {
            return 'Guest_' + Math.floor(Math.random() * 9999).toString().padStart(4, '0');
        }

        function generatePartyCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function validateUsername(username) {
            if (!username || username.length < 3 || username.length > 12) {
                return { valid: false, message: 'Username must be 3-12 characters' };
            }
            
            const validChars = /^[a-zA-Z\u0600-\u06FF]+$/;
            if (!validChars.test(username)) {
                return { valid: false, message: 'Only English and Arabic letters allowed' };
            }
            
            const lowerUsername = username.toLowerCase();
            for (let word of badWords) {
                if (lowerUsername.includes(word)) {
                    return { valid: false, message: 'Inappropriate username' };
                }
            }
            
            return { valid: true };
        }

        function updateUsername() {
            const newUsername = document.getElementById('username-input').value.trim();
            const validation = validateUsername(newUsername);
            
            if (!validation.valid) {
                if (validation.message === 'Inappropriate username') {
                    handleInappropriateUsername();
                } else {
                    showNotification(validation.message, 'error');
                }
                return;
            }
            
            currentUser.username = newUsername;
            currentUser.usernameChanges++;
            currentUser.lastUsernameChange = Date.now();
            saveUserData();
            updateUI();
            showNotification('Username updated successfully!', 'success');
            playSound('notification');
        }

        function handleInappropriateUsername() {
            currentUser.usernameChanges++;
            const changes = currentUser.usernameChanges;
            
            if (changes === 1) {
                showNotification('Warning: Inappropriate username', 'warning');
            } else if (changes === 2) {
                showNotification('5-minute cooldown applied', 'error');
                setTimeout(() => {
                    currentUser.usernameChanges = 0;
                }, 5 * 60 * 1000);
            } else if (changes === 3) {
                showNotification('1-day cooldown applied', 'error');
                setTimeout(() => {
                    currentUser.usernameChanges = 0;
                }, 24 * 60 * 60 * 1000);
            } else {
                currentUser.isBanned = true;
                showNotification('Username changes banned', 'error');
            }
            
            saveUserData();
        }

        function addXP(amount) {
            currentUser.xp += amount;
            const oldLevel = currentUser.level;
            
            while (currentUser.xp >= getXPNeeded(currentUser.level)) {
                currentUser.xp -= getXPNeeded(currentUser.level);
                currentUser.level++;
            }
            
            if (currentUser.level > oldLevel) {
                showLevelUp();
                updateRank();
            }
            
            saveUserData();
            updateUI();
        }

        function getXPNeeded(level) {
            let base = 100;
            let multiplier = 1;
            
            if (level <= 5) multiplier = 1.15;
            else if (level <= 10) multiplier = 1.25;
            else multiplier = 1.4;
            
            return Math.floor(base * Math.pow(multiplier, level - 1));
        }

        function showLevelUp() {
            const avatar = document.getElementById('profile-avatar');
            avatar.classList.add('level-up');
            setTimeout(() => avatar.classList.remove('level-up'), 1000);
            playSound('levelUp');
            showNotification(`Level Up! You are now level ${currentUser.level}`, 'success');
        }

        function updateRank() {
            const ranks = ['Rookie', 'Amateur', 'Pro', 'Expert', 'Master', 'Grandmaster', 'Legend', 'Mythic'];
            const rankIndex = Math.floor((currentUser.level - 1) / 10);
            currentUser.rank = ranks[Math.min(rankIndex, ranks.length - 1)];
        }

        function addCoins(amount) {
            currentUser.coins += amount;
            saveUserData();
            updateUI();
        }

        function detectDevice() {
            const userAgent = navigator.userAgent;
            let deviceName = 'Unknown';
            let deviceIcon = 'üíª';
            
            if (/iPhone/.test(userAgent)) {
                deviceName = 'iPhone';
                deviceIcon = 'üì±';
            } else if (/iPad/.test(userAgent)) {
                deviceName = 'iPad';
                deviceIcon = 'üì±';
            } else if (/Android/.test(userAgent) && /Mobile/.test(userAgent)) {
                deviceName = 'Android Phone';
                deviceIcon = 'üì±';
            } else if (/Android/.test(userAgent)) {
                deviceName = 'Android Tablet';
                deviceIcon = 'üì±';
            } else if (/Windows/.test(userAgent)) {
                deviceName = 'Windows PC';
                deviceIcon = 'üíª';
            } else if (/Mac/.test(userAgent)) {
                deviceName = 'Mac';
                deviceIcon = 'üíª';
            }
            
            document.getElementById('device-name').textContent = deviceIcon + ' ' + deviceName;
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('quizMasterSettings') || '{}');
            
            if (settings.darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('dark-mode-toggle').classList.add('active');
            }
            
            if (settings.accessibility) {
                document.body.classList.add('accessibility-mode');
                document.getElementById('accessibility-toggle').classList.add('active');
            }
            
            if (settings.highContrast) {
                document.body.classList.add('high-contrast');
                document.getElementById('contrast-toggle').classList.add('active');
            }
            
            if (settings.soundEnabled !== undefined) {
                soundEnabled = settings.soundEnabled;
                if (!soundEnabled) {
                    document.getElementById('sound-toggle').classList.remove('active');
                }
            }
            
            if (settings.language) {
                gameState.language = settings.language;
                document.getElementById('game-language').value = settings.language;
            }
        }

        function saveSettings() {
            const settings = {
                darkMode: document.body.classList.contains('dark-mode'),
                accessibility: document.body.classList.contains('accessibility-mode'),
                highContrast: document.body.classList.contains('high-contrast'),
                soundEnabled: soundEnabled,
                language: gameState.language
            };
            localStorage.setItem('quizMasterSettings', JSON.stringify(settings));
        }

        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const joinCode = urlParams.get('join');
            if (joinCode) {
                document.getElementById('party-code-input').value = joinCode;
                showJoinParty();
            }
        }

        function updateUI() {
            document.getElementById('username-input').value = currentUser.username;
            document.getElementById('avatar-letter').textContent = currentUser.username.charAt(0).toUpperCase();
            document.getElementById('player-level').textContent = currentUser.level;
            document.getElementById('player-xp').textContent = currentUser.xp;
            document.getElementById('player-coins').textContent = currentUser.coins;
            document.getElementById('player-rank').textContent = currentUser.rank;
            
            const xpNeeded = getXPNeeded(currentUser.level);
            const xpProgress = (currentUser.xp / xpNeeded) * 100;
            document.getElementById('xp-progress').style.width = xpProgress + '%';
        }

        function showTab(tabName) {
            playSound('click');
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + '-screen').classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        function showMain() {
            showTab('main');
        }

        function showCreateParty() {
            playSound('click');
            document.getElementById('main-screen').classList.remove('active');
            document.getElementById('create-party-screen').classList.add('active');
        }

        function showJoinParty() {
            playSound('click');
            document.getElementById('main-screen').classList.remove('active');
            document.getElementById('join-party-screen').classList.add('active');
        }
        
        function startPracticeMode() {
            playSound('click');
            gameState.isPracticeMode = true;
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.streak = 0;
            gameState.answers = [];
            gameState.gameStarted = true;
            gameState.practiceQuestions = generatePracticeQuestions();
            
            document.getElementById('main-screen').classList.remove('active');
            document.getElementById('practice-screen').classList.add('active');
            
            showNotification('Practice Mode Started!', 'success');
            nextPracticeQuestion();
        }
        
        function generatePracticeQuestions() {
            const allQuestions = [];
            Object.values(questions).forEach(category => {
                Object.values(category).forEach(difficulty => {
                    allQuestions.push(...difficulty);
                });
            });
            return allQuestions.sort(() => Math.random() - 0.5).slice(0, 10);
        }
        
        function nextPracticeQuestion() {
            if (gameState.currentQuestion >= 10) {
                endPracticeMode();
                return;
            }
            
            gameState.currentQuestion++;
            gameState.timeLeft = 10;
            
            const currentQ = gameState.practiceQuestions[gameState.currentQuestion - 1];
            const difficulty = currentQ.question.includes('deepest') || currentQ.question.includes('record') ? 'impossible' : 
                             currentQ.question.includes('smallest') || currentQ.question.includes('maximum') ? 'hard' : 'easy';
            
            document.getElementById('practice-question-num').textContent = gameState.currentQuestion;
            document.getElementById('practice-score').textContent = gameState.score;
            document.getElementById('practice-streak').textContent = gameState.streak;
            document.getElementById('practice-question-text').innerHTML = currentQ.question + 
                `<span class="difficulty-badge difficulty-${difficulty}">${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)}</span>`;
            
            const answerInput = document.getElementById('practice-answer-input');
            answerInput.value = '';
            answerInput.disabled = true;
            answerInput.placeholder = 'Get ready...';
            
            document.getElementById('practice-options-container').classList.add('hidden');
            
            setTimeout(() => {
                answerInput.disabled = false;
                answerInput.placeholder = 'Type your answer...';
                answerInput.focus();
                startPracticeTimer(currentQ, difficulty);
            }, 2000);
        }
        
        function startPracticeTimer(question, difficulty) {
            let timeLeft = 10;
            const timerDisplay = document.getElementById('practice-timer-display');
            
            const timer = setInterval(() => {
                timerDisplay.textContent = timeLeft;
                const percentage = (timeLeft / 10) * 360;
                timerDisplay.style.background = `conic-gradient(#e74c3c ${360 - percentage}deg, #3498db ${360 - percentage}deg)`;
                
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(timer);
                    submitPracticeAnswer(question, difficulty);
                }
            }, 1000);
            
            document.getElementById('practice-answer-input').onkeypress = function(e) {
                if (e.key === 'Enter') {
                    clearInterval(timer);
                    submitPracticeAnswer(question, difficulty);
                    this.onkeypress = null;
                }
            };
        }
        
        function submitPracticeAnswer(question, difficulty) {
            const userAnswer = document.getElementById('practice-answer-input').value.trim().toLowerCase();
            const correctAnswer = question.answer.toLowerCase();
            const isCorrect = userAnswer === correctAnswer;
            
            if (isCorrect) {
                gameState.streak++;
                const basePoints = difficulty === 'easy' ? 5 : difficulty === 'hard' ? 7 : 9;
                const streakBonus = Math.floor(gameState.streak / 3);
                const points = basePoints + streakBonus;
                
                gameState.score += points;
                addXP(points);
                addCoins(Math.floor(basePoints / 2));
                
                playSound('correct');
                showNotification(`Correct! +${points} points`, 'success');
                
                setTimeout(() => nextPracticeQuestion(), 2000);
            } else {
                gameState.streak = 0;
                playSound('wrong');
                showPracticeMultipleChoice(question);
            }
            
            document.getElementById('practice-answer-input').disabled = true;
        }
        
        function showPracticeMultipleChoice(question) {
            const optionsContainer = document.getElementById('practice-options-container');
            optionsContainer.classList.remove('hidden');
            optionsContainer.innerHTML = '';
            
            const shuffledOptions = [...question.options].sort(() => Math.random() - 0.5);
            
            shuffledOptions.forEach(option => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.textContent = option;
                optionBtn.onclick = () => selectPracticeOption(option, question.answer);
                optionsContainer.appendChild(optionBtn);
            });
        }
        
        function selectPracticeOption(selectedOption, correctAnswer) {
            const buttons = document.querySelectorAll('#practice-options-container .option-btn');
            const isCorrect = selectedOption.toLowerCase() === correctAnswer.toLowerCase();
            
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent.toLowerCase() === correctAnswer.toLowerCase()) {
                    btn.classList.add('correct');
                } else if (btn.textContent === selectedOption && !isCorrect) {
                    btn.classList.add('wrong');
                }
            });
            
            if (isCorrect) {
                gameState.score += 2;
                addXP(2);
                addCoins(1);
                playSound('correct');
                showNotification('Correct! +2 points', 'success');
            } else {
                playSound('wrong');
                showNotification('Wrong answer!', 'error');
            }
            
            setTimeout(() => nextPracticeQuestion(), 3000);
        }
        
        function endPracticeMode() {
            document.getElementById('practice-screen').classList.remove('active');
            document.getElementById('practice-results-screen').classList.add('active');
            
            document.getElementById('practice-final-score').textContent = gameState.score;
            document.getElementById('practice-total-questions').textContent = '10';
            document.getElementById('practice-correct-answers').textContent = 
                Math.floor(gameState.score / 3);
            
            currentUser.totalGames++;
            saveUserData();
            
            playSound('levelUp');
            showNotification(`Practice Complete! Final Score: ${gameState.score}`, 'success');
        }
        
        function restartPractice() {
            playSound('click');
            document.getElementById('practice-results-screen').classList.remove('active');
            startPracticeMode();
        }
        
        function exitPractice() {
            playSound('click');
            gameState.isPracticeMode = false;
            document.getElementById('practice-results-screen').classList.remove('active');
            document.getElementById('practice-screen').classList.remove('active');
            document.getElementById('main-screen').classList.add('active');
        }

        function createParty() {
            playSound('click');
            const maxPlayers = parseInt(document.getElementById('max-players').value);
            const language = document.getElementById('game-language').value;
            const category = document.getElementById('quiz-category').value;
            const difficulty = document.getElementById('quiz-difficulty').value;
            
            const partyCode = generatePartyCode();
            const party = {
                code: partyCode,
                host: currentUser.username,
                maxPlayers: maxPlayers,
                players: [currentUser],
                language: language,
                category: category,
                difficulty: difficulty,
                created: Date.now(),
                gameStarted: false
            };
            
            parties.set(partyCode, party);
            gameState.currentParty = partyCode;
            gameState.isHost = true;
            gameState.language = language;
            
            document.getElementById('current-party-code').textContent = partyCode;
            const inviteLink = window.location.origin + window.location.pathname + '?join=' + partyCode;
            document.getElementById('invite-link-display').textContent = 'Invite Link: ' + inviteLink;
            
            updatePlayerList();
            showPartyLobby();
            startPartyTimer();
        }

        function joinParty() {
            playSound('click');
            const partyCode = document.getElementById('party-code-input').value.toUpperCase().trim();
            
            if (!partyCode) {
                showNotification('Please enter a party code', 'error');
                return;
            }
            
            let party = parties.get(partyCode);
            if (!party) {
                party = {
                    code: partyCode,
                    host: 'AutoHost',
                    maxPlayers: 4,
                    players: [],
                    language: 'en',
                    category: 'sports',
                    difficulty: 'random',
                    created: Date.now(),
                    gameStarted: false
                };
                parties.set(partyCode, party);
                showNotification('Party created for you!', 'success');
            }
            
            if (party.players.length >= party.maxPlayers) {
                showNotification(`Party full (${party.players.length}/${party.maxPlayers})`, 'error');
                return;
            }
            
            if (party.gameStarted) {
                showNotification('Game already started', 'error');
                return;
            }
            
            const isAlreadyInParty = party.players.some(p => p.username === currentUser.username);
            if (!isAlreadyInParty) {
                party.players.push({...currentUser});
                showNotification(`Joined party! (${party.players.length}/${party.maxPlayers})`, 'success');
            }
            
            gameState.currentParty = partyCode;
            gameState.isHost = party.players[0]?.username === currentUser.username;
            gameState.language = party.language;
            
            document.getElementById('current-party-code').textContent = partyCode;
            const inviteLink = window.location.origin + window.location.pathname + '?join=' + partyCode;
            document.getElementById('invite-link-display').textContent = 'Invite Link: ' + inviteLink;
            
            updatePlayerList();
            showPartyLobby();
        }

        function showPartyLobby() {
            document.getElementById('join-party-screen').classList.remove('active');
            document.getElementById('create-party-screen').classList.remove('active');
            document.getElementById('party-lobby-screen').classList.add('active');
            
            if (!gameState.isHost) {
                document.getElementById('host-controls').style.display = 'none';
            }
            
            applyLanguage();
        }

        function updatePlayerList() {
            const party = parties.get(gameState.currentParty);
            if (!party) return;
            
            const playerList = document.getElementById('player-list');
            playerList.innerHTML = `<h3>Players (${party.players.length}/${party.maxPlayers})</h3>`;
            
            party.players.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player';
                
                const isHost = index === 0;
                const hostBadge = isHost ? ' üëë' : '';
                
                playerDiv.innerHTML = `
                    <div class="avatar">
                        <span>${player.username.charAt(0).toUpperCase()}</span>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: bold;">${player.username}${hostBadge}</div>
                        <div style="font-size: 0.9em; opacity: 0.8;">Level ${player.level || 1}</div>
                    </div>
                    <div class="device-icon">üíª</div>
                    ${gameState.isHost && !isHost ? '<button class="btn danger" onclick="kickPlayer(' + index + ')">Kick</button>' : ''}
                `;
                
                playerList.appendChild(playerDiv);
            });
        }

        function kickPlayer(playerIndex) {
            const party = parties.get(gameState.currentParty);
            if (!party || !gameState.isHost || playerIndex === 0) return;
            
            party.players.splice(playerIndex, 1);
            updatePlayerList();
            showNotification('Player kicked', 'warning');
        }

        function startPartyTimer() {
            let timeLeft = 300;
            const countdown = document.getElementById('lobby-countdown');
            
            const timer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                countdown.textContent = `Auto-start in ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(timer);
                    if (gameState.isHost) {
                        startGame();
                    }
                }
            }, 1000);
        }

        function startGame() {
            playSound('click');
            const party = parties.get(gameState.currentParty);
            if (!party || party.players.length < 2) {
                showNotification('Need at least 2 players to start', 'error');
                return;
            }
            
            party.gameStarted = true;
            gameState.gameStarted = true;
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.streak = 0;
            gameState.answers = [];
            
            document.getElementById('party-lobby-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
            
            nextQuestion();
        }

        function nextQuestion() {
            if (gameState.currentQuestion >= 10) {
                endGame();
                return;
            }
            
            gameState.currentQuestion++;
            gameState.timeLeft = 10;
            
            const party = parties.get(gameState.currentParty);
            const questions_category = questions[party.category] || questions.sports;
            const difficulty = party.difficulty === 'random' ? 
                ['easy', 'hard', 'impossible'][Math.floor(Math.random() * 3)] : 
                party.difficulty;
            
            const questionPool = questions_category[difficulty] || questions_category.easy;
            const currentQ = questionPool[Math.floor(Math.random() * questionPool.length)];
            
            document.getElementById('current-question').textContent = gameState.currentQuestion;
            document.getElementById('current-score').textContent = gameState.score;
            document.getElementById('current-streak').textContent = gameState.streak;
            document.getElementById('question-text').innerHTML = currentQ.question + 
                `<span class="difficulty-badge difficulty-${difficulty}">${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)}</span>`;
            
            const answerInput = document.getElementById('answer-input');
            answerInput.value = '';
            answerInput.disabled = true;
            answerInput.placeholder = 'Wait for countdown...';
            
            document.getElementById('options-container').classList.add('hidden');
            
            setTimeout(() => {
                answerInput.disabled = false;
                answerInput.placeholder = 'Enter your answer...';
                answerInput.focus();
                startQuestionTimer(currentQ, difficulty);
            }, 2000);
        }

        function startQuestionTimer(question, difficulty) {
            let timeLeft = 10;
            const timerDisplay = document.getElementById('timer-display');
            
            const timer = setInterval(() => {
                timerDisplay.textContent = timeLeft;
                const percentage = (timeLeft / 10) * 360;
                timerDisplay.style.background = `conic-gradient(#e74c3c ${360 - percentage}deg, #3498db ${360 - percentage}deg)`;
                
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(timer);
                    submitAnswer(question, difficulty);
                }
            }, 1000);
            
            document.getElementById('answer-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    clearInterval(timer);
                    submitAnswer(question, difficulty);
                }
            }, { once: true });
        }

        function submitAnswer(question, difficulty) {
            const userAnswer = document.getElementById('answer-input').value.trim().toLowerCase();
            const correctAnswer = question.answer.toLowerCase();
            const isCorrect = userAnswer === correctAnswer;
            
            if (isCorrect) {
                gameState.streak++;
                const basePoints = difficulty === 'easy' ? 5 : difficulty === 'hard' ? 7 : 9;
                const streakBonus = Math.floor(gameState.streak / 3);
                const points = basePoints + streakBonus;
                
                gameState.score += points;
                addXP(points * 2);
                addCoins(basePoints);
                
                playSound('correct');
                showNotification(`Correct! +${points} points`, 'success');
                
                setTimeout(() => nextQuestion(), 2000);
            } else {
                gameState.streak = 0;
                playSound('wrong');
                showMultipleChoice(question);
            }
            
            document.getElementById('answer-input').disabled = true;
        }

        function showMultipleChoice(question) {
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.classList.remove('hidden');
            optionsContainer.innerHTML = '';
            
            const shuffledOptions = [...question.options].sort(() => Math.random() - 0.5);
            
            shuffledOptions.forEach(option => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.textContent = option;
                optionBtn.onclick = () => selectOption(option, question.answer);
                optionsContainer.appendChild(optionBtn);
            });
        }

        function selectOption(selectedOption, correctAnswer) {
            const options = document.querySelectorAll('.option-btn');
            options.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct');
                } else if (btn.textContent === selectedOption && selectedOption !== correctAnswer) {
                    btn.classList.add('wrong');
                }
            });
            
            if (selectedOption === correctAnswer) {
                gameState.score += 2;
                addXP(2);
                addCoins(1);
                playSound('correct');
                showNotification('Correct! +2 points', 'success');
            } else {
                playSound('wrong');
                showNotification('Wrong answer!', 'error');
            }
            
            setTimeout(() => nextQuestion(), 3000);
        }

        function endGame() {
            currentUser.totalGames++;
            if (gameState.score > 0) {
                currentUser.wins++;
            }
            saveUserData();
            
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('game-results-screen').classList.add('active');
            
            showLeaderboard();
            startResultsTimer();
        }

        function showLeaderboard() {
            const party = parties.get(gameState.currentParty);
            if (!party) return;
            
            const leaderboard = document.getElementById('final-leaderboard');
            leaderboard.innerHTML = '<h3>Final Scores</h3>';
            
            const sortedPlayers = [...party.players].sort((a, b) => (b.score || 0) - (a.score || 0));
            
            sortedPlayers.forEach((player, index) => {
                const isWinner = index === 0;
                const item = document.createElement('div');
                item.className = `leaderboard-item ${isWinner ? 'winner' : ''}`;
                
                const trophy = index === 0 ? 'üèÜ' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
                
                item.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <span style="font-size: 1.5rem; margin-right: 10px;">${trophy}</span>
                        <div class="avatar">
                            <span>${player.username.charAt(0).toUpperCase()}</span>
                        </div>
                        <div style="margin-left: 10px;">
                            <div style="font-weight: bold;">${player.username}</div>
                            <div style="font-size: 0.9em; opacity: 0.8;">Level ${player.level || 1}</div>
                        </div>
                    </div>
                    <div style="font-size: 1.2rem; font-weight: bold;">
                        ${player.score || 0} pts
                    </div>
                `;
                
                leaderboard.appendChild(item);
            });
        }

        function startResultsTimer() {
            let timeLeft = 30;
            const countdown = document.getElementById('results-countdown');
            
            const timer = setInterval(() => {
                countdown.textContent = `Returning to lobby in ${timeLeft}s`;
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(timer);
                    returnToLobby();
                }
            }, 1000);
        }

        function returnToLobby() {
            const party = parties.get(gameState.currentParty);
            if (party) {
                party.gameStarted = false;
                party.code = generatePartyCode();
                parties.set(party.code, party);
                parties.delete(gameState.currentParty);
                gameState.currentParty = party.code;
                
                document.getElementById('current-party-code').textContent = party.code;
                const inviteLink = window.location.origin + window.location.pathname + '?join=' + party.code;
                document.getElementById('invite-link-display').textContent = 'Invite Link: ' + inviteLink;
            }
            
            document.getElementById('game-results-screen').classList.remove('active');
            document.getElementById('party-lobby-screen').classList.add('active');
            
            updatePlayerList();
            startPartyTimer();
        }

        function leaveParty() {
            playSound('click');
            gameState.currentParty = null;
            gameState.isHost = false;
            gameState.gameStarted = false;
            
            showMain();
            showNotification('Left party', 'warning');
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            document.getElementById('dark-mode-toggle').classList.toggle('active');
            saveSettings();
            playSound('click');
        }

        function toggleAccessibility() {
            document.body.classList.toggle('accessibility-mode');
            document.getElementById('accessibility-toggle').classList.toggle('active');
            saveSettings();
            playSound('click');
        }

        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
            document.getElementById('contrast-toggle').classList.toggle('active');
            saveSettings();
            playSound('click');
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-toggle').classList.toggle('active');
            saveSettings();
            if (soundEnabled) playSound('click');
        }

        function changeLanguage() {
            gameState.language = document.getElementById('game-language').value;
            saveSettings();
            applyLanguage();
        }

        function applyLanguage() {
            const lang = gameState.language;
            const texts = translations[lang] || translations.en;
            
            Object.keys(texts).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = texts[key];
                }
            });
            
            if (lang === 'ar') {
                document.body.classList.add('rtl');
                document.documentElement.dir = 'rtl';
            } else {
                document.body.classList.remove('rtl');
                document.documentElement.dir = 'ltr';
            }
        }

        function buyItem(itemId, cost) {
            if (currentUser.coins < cost) {
                showNotification('Not enough coins!', 'error');
                return;
            }
            
            if (currentUser.ownedItems.includes(itemId)) {
                showNotification('Already owned!', 'warning');
                return;
            }
            
            currentUser.coins -= cost;
            currentUser.ownedItems.push(itemId);
            saveUserData();
            updateUI();
            
            playSound('notification');
            showNotification('Item purchased!', 'success');
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} bounce-in`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
                notification.classList.add('fade-out');
            }, 3000);
            
            setTimeout(() => {
                notification.classList.remove('fade-out', 'bounce-in');
            }, 3500);
        }
        
        function createFloatingParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 4 + 2;
                const left = Math.random() * 100;
                const animationDelay = Math.random() * 6;
                const animationDuration = Math.random() * 3 + 4;
                
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.left = left + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = animationDelay + 's';
                particle.style.animationDuration = animationDuration + 's';
                
                particlesContainer.appendChild(particle);
            }
        }
        
        function addCoolEffects() {
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('bounce-in');
                }, index * 100);
            });
            
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => {
                btn.addEventListener('mouseenter', () => {
                    btn.classList.add('pulse-animation');
                });
                btn.addEventListener('mouseleave', () => {
                    btn.classList.remove('pulse-animation');
                });
                btn.addEventListener('click', () => {
                    btn.classList.add('glow-effect');
                    setTimeout(() => btn.classList.remove('glow-effect'), 1000);
                });
            });
        }

        function cleanupExpiredParties() {
            const now = Date.now();
            for (let [code, party] of parties.entries()) {
                if (now - party.created > 5 * 60 * 1000) {
                    parties.delete(code);
                }
            }
        }

        setInterval(cleanupExpiredParties, 60000);

        document.addEventListener('DOMContentLoaded', initializeApp);
        window.addEventListener('beforeunload', saveUserData);

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                saveUserData();
            }
        });

        function enhanceInitialization() {
            loadUserData();
            updateUI();
            detectDevice();
            loadSettings();
            checkUrlParams();
            applyLanguage();
            createFloatingParticles();
            addCoolEffects();
            
            setTimeout(() => {
                document.body.classList.add('slide-up');
            }, 100);
        }
        
        initializeApp();
        enhanceInitialization();
    </script>
</body>
</html>
